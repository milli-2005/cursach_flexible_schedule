<!-- templates/core/schedules/edit_schedule.html -->
{% extends "core/base.html" %}
{% load static %}

{% block title %}Редактирование графика - {{ block.super }}{% endblock %}

{% block content %}
<div class="management-container">
    <h2>Редактирование графика "{{ schedule.name }}"</h2>
    <p class="text-muted">Период: {{ schedule.start_date }} — {{ schedule.end_date }}</p>

    <div class="table-responsive">
        <table class="table table-bordered table-dark">
            <thead>
                <tr>
                    <th>Время</th>
                    {% for day in days %}
                        <th>{{ day|date:"D, d M" }}</th>
                    {% endfor %}
                </tr>
            </thead><tbody>
    {% for slot in slots %}
    <tr>
        <td>{{ slot }}</td>
        {% for day in days %}
        <td>
            <!-- Найдём назначение для этой ячейки -->
            {% with current_assignment=None %}
                {% for item in assignment_list %}
                    {% if item.date == day and item.time_start == slot|slice:":5" %}
                        {% with current_assignment=item %}{% endwith %}
                    {% endif %}
                {% endfor %}

                <!-- ВСЕГДА отображаем списки -->
                <select class="form-select form-select-sm mb-1 employee-select">
                    <option value="">Выберите...</option>
                    {% for emp in employees %}
                        <option value="{{ emp.id }}"
                                {% if current_assignment and current_assignment.employee.id == emp.id %}selected{% endif %}>
                            {{ emp.user.username }}
                        </option>
                    {% endfor %}
                </select>
                <select class="form-select form-select-sm workout-select">
                    <option value="">Занятие</option>
                    {% for wt in workout_types %}
                        <option value="{{ wt.id }}"
                                {% if current_assignment and current_assignment.workout_type and current_assignment.workout_type.id == wt.id %}selected{% endif %}>
                            {{ wt.name }}
                        </option>
                    {% endfor %}
                </select>
            {% endwith %}
        </td>
        {% endfor %}
    </tr>
    {% endfor %}
</tbody>
        </table>
    </div>
    <button id="save-schedule-btn" class="btn btn-primary">Сохранить изменения</button>
</div>
{% endblock %}